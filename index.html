<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Srpski_Cas Mini App</title>
  <link rel="stylesheet" href="styles.css" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
  <main class="app">
    <h1>Srpski_Cas Mini App</h1>
    <p>Минимальная стартовая страница для Mini App.</p>
    <div class="card">
      <div class="label">Статус</div>
      <div id="status">Ожидание запуска в Telegram…</div>
    </div>
    <a class="btn" href="https://t.me/SrpskiCas_bot">Открыть бота</a>
  </main>

  <script>
    const API_BASE = 'https://api.intelahost.org';
    const status = document.getElementById('status');
    const tg = window.Telegram && window.Telegram.WebApp;

    if (tg) {
      tg.ready();
      status.textContent = 'Mini App открыт через Telegram WebApp';
      const initData = tg.initData || '';

      if (initData) {
        fetch(`${API_BASE}/access?initData=${encodeURIComponent(initData)}`)
          .then((r) => r.json())
          .then((data) => {
            if (data && data.ok) {
              status.textContent = 'Доступ подтверждён';
            } else {
              status.textContent = `Ответ backend: ${JSON.stringify(data)}`;
            }
          })
          .catch((err) => {
            status.textContent = `Ошибка запроса: ${err}`;
          });
      } else {
        status.textContent = 'initData отсутствует (открыто не из WebApp)';
      }
    } else {
      status.textContent = 'Откройте страницу из Telegram WebApp';
    }
  </script>
</body>
</html>
